<p id="notice"><%= notice %></p>

<h1><%= @portfolio.name %></h1>

<table class="nostradamus-standard">
	<thead>
		<tr>
			<th>Ticker</th>
			<th>Shares</th>
			<th>Asset Name</th>
			<th>Price</th>
			<th>% of Port</th>
		</tr>
	</thead>
	<tbody>
		<% for p in @portfolio.positions %>
		<tr>
			<td> <%= p.asset.ticker unless !p.asset %></td>
			<td> <%= p.shares %> </td>
			<td> <%= p.asset.name unless !p.asset   %></td>
			<td>  </td>
			<td align="right"> <%= p.holding_percentage %></td>	
    		<td><%= link_to '[x]', p, :method => :delete, :remote => true, :class => 'delete-position', 'data-type' => 'json' %></td>
		</tr>
		<% end %>
	</tbody>
</table>

<br/>

<%= link_to 'Edit', 	edit_portfolio_path(@portfolio) %> |
<%= link_to 'Back',		portfolios_path %> |
<%= link_to 'Matrix', 	custom_path(:period =>  91, :portfolio => @portfolio) %>

<script type="text/javascript">
	$(document).ready(function(){
	
	  $('.delete-position')

	    .live("ajax:success", function(evt, data, status, xhr){
	      $position = $(this).closest('tr').fadeOut();			
	    })
	    
	    .live("ajax:error", function(evt, xhr, status, error){
	      var $form = $(this),
	          errors,
	          errorText;
	
	      try {
	        // Populate errorText with the comment errors
	        errors = $.parseJSON(xhr.responseText);
	      } catch(err) {
	        // If the responseText is not valid JSON (like if a 500 exception was thrown), populate errors with a generic error message.
	        errors = {message: "Please reload the page and try again"};
	      }
	
	      // Build an unordered list from the list of errors
	      errorText = "There were errors with the submission: \n<ul>";
	
	      for ( error in errors ) {
	        errorText += "<li>" + error + ': ' + errors[error] + "</li> ";
	      }
	
	      errorText += "</ul>";
	
	      // Insert error list into form
	      $form.find('div.validation-error').html(errorText);
	    });
	
	});
</script>
