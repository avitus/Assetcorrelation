<%= nested_form_for @portfolio  do |f| %>
	
	<%= f.text_field(:name, :placeholder => 'Your portfolio name') %>

	<table class="nostradamus-standard">
		<thead>
			<tr>
				<th>Ticker</th>
				<th>Shares</th>
				<th>Asset Name</th>
			</tr>
		</thead>
	</table>
    
	<%= f.fields_for :positions %>
	
	<p><%= f.link_to_add "Add a Position", :positions, :class => 'asset-add-link' %></p>  
  
  	<%= f.submit "Create Portfolio" %>
  	
<% end %>

<script type="text/javascript">

	$(document).ready(function(){
	
		$('.asset-ticker').livequery(function() {
		
			$(this).observe_field( 0.5, function() {
		  	
			  	var $assetRowSelector = $(this);
				
				$.get('/valid_asset', { query: this.value }, 
					function(data) {
						if(typeof(data) != 'undefined' && data != null) {
							$assetRowSelector.siblings('.asset-name').html(data.name).removeClass("input-error");;
							$assetRowSelector.siblings('.asset-num').val(data.id);							
						}
						else {
							$assetRowSelector.siblings('.asset-name').html('Invalid ticker').addClass("input-error");
							$assetRowSelector.siblings('.asset-num').val('-');								
						}
					}, "json" );
				});
		});
		
	});
		
</script>
